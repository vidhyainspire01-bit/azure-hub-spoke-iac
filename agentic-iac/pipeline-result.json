{
    "status": "completed",
    "analysis": {
        "findings": [
            {
                "file": "azure-hub-spoke/spoke2/spoke2.tf",
                "line": 22,
                "issue": "Missing NSG association for subnet",
                "severity": "high",
                "fix_hint": "Attach azurerm_network_security_group to this subnet",
                "resource_type": "azurerm_subnet"
            },
            {
                "file": "azure-hub-spoke/spoke2/spoke2.tf",
                "line": 54,
                "issue": "Missing NSG association for subnet",
                "severity": "high",
                "fix_hint": "Attach azurerm_network_security_group to this subnet",
                "resource_type": "azurerm_subnet"
            },
            {
                "file": "azure-hub-spoke/spoke1/spoke1.tf",
                "line": 25,
                "issue": "Reference to undefined network security group",
                "severity": "high",
                "fix_hint": "Define azurerm_network_security_group.default before referencing it",
                "resource_type": "azurerm_subnet"
            },
            {
                "file": "azure-hub-spoke/spoke1/spoke1.tf",
                "line": 45,
                "issue": "Reference to undefined network security group",
                "severity": "high",
                "fix_hint": "Define azurerm_network_security_group.default before referencing it",
                "resource_type": "azurerm_subnet"
            },
            {
                "file": "azure-hub-spoke/hub/firewall.tf",
                "line": 12,
                "issue": "Missing NSG association for Azure Firewall subnet",
                "severity": "high",
                "fix_hint": "Attach azurerm_network_security_group to azurerm_subnet.AzureFirewallSubnet",
                "resource_type": "azurerm_subnet"
            },
            {
                "file": "azure-hub-spoke/hub/firewall.tf",
                "line": 24,
                "issue": "Open inbound rule exposes port 22 to the world",
                "severity": "high",
                "fix_hint": "Restrict source_address_prefix for inbound rule to a specific IP or range",
                "resource_type": "azurerm_network_security_rule"
            }
        ],
        "failed_checks": [
            {
                "check_id": "CKV_AZURE_10",
                "bc_check_id": "BC_AZR_NETWORKING_3",
                "check_name": "Ensure that SSH access is restricted from the internet",
                "check_result": {
                    "result": "FAILED",
                    "evaluated_keys": [
                        "access",
                        "direction",
                        "protocol",
                        "destination_port_range",
                        "destination_port_ranges",
                        "source_address_prefix",
                        "source_address_prefixes"
                    ]
                },
                "code_block": [
                    [
                        24,
                        "resource \"azurerm_network_security_rule\" \"bad_rule\" {\n"
                    ],
                    [
                        25,
                        "  name                       = \"open-to-world\"\n"
                    ],
                    [
                        26,
                        "  priority                   = 100\n"
                    ],
                    [
                        27,
                        "  direction                  = \"Inbound\"\n"
                    ],
                    [
                        28,
                        "  access                     = \"Allow\"\n"
                    ],
                    [
                        29,
                        "  protocol                   = \"*\"\n"
                    ],
                    [
                        30,
                        "  source_port_range          = \"*\"\n"
                    ],
                    [
                        31,
                        "  destination_port_range     = \"22\"\n"
                    ],
                    [
                        32,
                        "  source_address_prefix      = \"*\"\n"
                    ],
                    [
                        33,
                        "  destination_address_prefix = \"*\"\n"
                    ],
                    [
                        34,
                        "\n"
                    ],
                    [
                        35,
                        "  # associate this rule with the NSG created above\n"
                    ],
                    [
                        36,
                        "  network_security_group_name = azurerm_network_security_group.bad_nsg.name\n"
                    ],
                    [
                        37,
                        "  resource_group_name         = azurerm_network_security_group.bad_nsg.resource_group_name\n"
                    ],
                    [
                        38,
                        "}\n"
                    ]
                ],
                "file_path": "/hub/firewall.tf",
                "file_abs_path": "/home/runner/work/azure-hub-spoke-iac/azure-hub-spoke-iac/azure-hub-spoke/hub/firewall.tf",
                "repo_file_path": "/azure-hub-spoke/hub/firewall.tf",
                "file_line_range": [
                    24,
                    38
                ],
                "resource": "azurerm_network_security_rule.bad_rule",
                "evaluations": null,
                "check_class": "checkov.terraform.checks.resource.azure.NSGRuleSSHAccessRestricted",
                "fixed_definition": null,
                "entity_tags": null,
                "caller_file_path": null,
                "caller_file_line_range": null,
                "resource_address": null,
                "severity": null,
                "bc_category": null,
                "benchmarks": null,
                "description": null,
                "short_description": null,
                "vulnerability_details": null,
                "connected_node": null,
                "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/azure-policies/azure-networking-policies/bc-azr-networking-3",
                "details": [],
                "check_len": null,
                "definition_context_file_path": "/home/runner/work/azure-hub-spoke-iac/azure-hub-spoke-iac/azure-hub-spoke/hub/firewall.tf",
                "breadcrumbs": {
                    "network_security_group_name": [
                        {
                            "type": "resource",
                            "name": "azurerm_network_security_group.bad_nsg",
                            "path": "/home/runner/work/azure-hub-spoke-iac/azure-hub-spoke-iac/azure-hub-spoke/hub/firewall.tf",
                            "module_connection": false
                        }
                    ],
                    "resource_group_name": [
                        {
                            "type": "resource",
                            "name": "azurerm_network_security_group.bad_nsg",
                            "path": "/home/runner/work/azure-hub-spoke-iac/azure-hub-spoke-iac/azure-hub-spoke/hub/firewall.tf",
                            "module_connection": false
                        }
                    ]
                }
            },
            {
                "check_id": "CKV_AZURE_50",
                "bc_check_id": "BC_AZR_GENERAL_14",
                "check_name": "Ensure Virtual Machine Extensions are not Installed",
                "check_result": {
                    "result": "FAILED",
                    "evaluated_keys": [
                        "allow_extension_operations"
                    ]
                },
                "code_block": [
                    [
                        43,
                        "resource \"azurerm_windows_virtual_machine\" \"vm1\" {\n"
                    ],
                    [
                        44,
                        "  name                = \"myvm\"\n"
                    ],
                    [
                        45,
                        "  location            = azurerm_resource_group.spoke2.location\n"
                    ],
                    [
                        46,
                        "  resource_group_name = azurerm_resource_group.spoke2.name\n"
                    ],
                    [
                        47,
                        "  size                = \"Standard_B2s\"\n"
                    ],
                    [
                        48,
                        "  admin_username      = \"adminuser\"\n"
                    ],
                    [
                        49,
                        "  admin_password      = \"P@ssw0rd1234!\"\n"
                    ],
                    [
                        50,
                        "\n"
                    ],
                    [
                        51,
                        "  network_interface_ids = [azurerm_network_interface.vm1_nic.id]\n"
                    ],
                    [
                        52,
                        "\n"
                    ],
                    [
                        53,
                        "  os_disk {\n"
                    ],
                    [
                        54,
                        "    name                 = \"myvm_os_disk\"\n"
                    ],
                    [
                        55,
                        "    caching              = \"ReadWrite\"\n"
                    ],
                    [
                        56,
                        "    storage_account_type = \"Standard_LRS\"\n"
                    ],
                    [
                        57,
                        "    disk_size_gb         = 64\n"
                    ],
                    [
                        58,
                        "  }\n"
                    ],
                    [
                        59,
                        "\n"
                    ],
                    [
                        60,
                        "  source_image_reference {\n"
                    ],
                    [
                        61,
                        "    publisher = \"MicrosoftWindowsServer\"\n"
                    ],
                    [
                        62,
                        "    offer     = \"WindowsServer\"\n"
                    ],
                    [
                        63,
                        "    sku       = \"2019-Datacenter\"\n"
                    ],
                    [
                        64,
                        "    version   = \"latest\"\n"
                    ],
                    [
                        65,
                        "  }\n"
                    ],
                    [
                        66,
                        "  tags = {\n"
                    ],
                    [
                        67,
                        "    environment = \"dev\"\n"
                    ],
                    [
                        68,
                        "    owner       = \"vidhya\"\n"
                    ],
                    [
                        69,
                        "  }\n"
                    ],
                    [
                        70,
                        "}\n"
                    ]
                ],
                "file_path": "/spoke2/spoke2.tf",
                "file_abs_path": "/home/runner/work/azure-hub-spoke-iac/azure-hub-spoke-iac/azure-hub-spoke/spoke2/spoke2.tf",
                "repo_file_path": "/azure-hub-spoke/spoke2/spoke2.tf",
                "file_line_range": [
                    43,
                    70
                ],
                "resource": "azurerm_windows_virtual_machine.vm1",
                "evaluations": null,
                "check_class": "checkov.terraform.checks.resource.azure.AzureInstanceExtensions",
                "fixed_definition": null,
                "entity_tags": {
                    "environment": "dev",
                    "owner": "vidhya"
                },
                "caller_file_path": null,
                "caller_file_line_range": null,
                "resource_address": null,
                "severity": null,
                "bc_category": null,
                "benchmarks": null,
                "description": null,
                "short_description": null,
                "vulnerability_details": null,
                "connected_node": null,
                "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/azure-policies/azure-general-policies/bc-azr-general-14",
                "details": [],
                "check_len": null,
                "definition_context_file_path": "/home/runner/work/azure-hub-spoke-iac/azure-hub-spoke-iac/azure-hub-spoke/spoke2/spoke2.tf",
                "breadcrumbs": {
                    "location": [
                        {
                            "type": "resource",
                            "name": "azurerm_resource_group.spoke2",
                            "path": "/home/runner/work/azure-hub-spoke-iac/azure-hub-spoke-iac/azure-hub-spoke/spoke2/spoke2.tf",
                            "module_connection": false
                        }
                    ],
                    "resource_group_name": [
                        {
                            "type": "resource",
                            "name": "azurerm_resource_group.spoke2",
                            "path": "/home/runner/work/azure-hub-spoke-iac/azure-hub-spoke-iac/azure-hub-spoke/spoke2/spoke2.tf",
                            "module_connection": false
                        }
                    ]
                }
            },
            {
                "check_id": "CKV_AZURE_151",
                "bc_check_id": "BC_AZR_GENERAL_89",
                "check_name": "Ensure Windows VM enables encryption",
                "check_result": {
                    "result": "FAILED",
                    "evaluated_keys": [
                        "encryption_at_host_enabled"
                    ]
                },
                "code_block": [
                    [
                        43,
                        "resource \"azurerm_windows_virtual_machine\" \"vm1\" {\n"
                    ],
                    [
                        44,
                        "  name                = \"myvm\"\n"
                    ],
                    [
                        45,
                        "  location            = azurerm_resource_group.spoke2.location\n"
                    ],
                    [
                        46,
                        "  resource_group_name = azurerm_resource_group.spoke2.name\n"
                    ],
                    [
                        47,
                        "  size                = \"Standard_B2s\"\n"
                    ],
                    [
                        48,
                        "  admin_username      = \"adminuser\"\n"
                    ],
                    [
                        49,
                        "  admin_password      = \"P@ssw0rd1234!\"\n"
                    ],
                    [
                        50,
                        "\n"
                    ],
                    [
                        51,
                        "  network_interface_ids = [azurerm_network_interface.vm1_nic.id]\n"
                    ],
                    [
                        52,
                        "\n"
                    ],
                    [
                        53,
                        "  os_disk {\n"
                    ],
                    [
                        54,
                        "    name                 = \"myvm_os_disk\"\n"
                    ],
                    [
                        55,
                        "    caching              = \"ReadWrite\"\n"
                    ],
                    [
                        56,
                        "    storage_account_type = \"Standard_LRS\"\n"
                    ],
                    [
                        57,
                        "    disk_size_gb         = 64\n"
                    ],
                    [
                        58,
                        "  }\n"
                    ],
                    [
                        59,
                        "\n"
                    ],
                    [
                        60,
                        "  source_image_reference {\n"
                    ],
                    [
                        61,
                        "    publisher = \"MicrosoftWindowsServer\"\n"
                    ],
                    [
                        62,
                        "    offer     = \"WindowsServer\"\n"
                    ],
                    [
                        63,
                        "    sku       = \"2019-Datacenter\"\n"
                    ],
                    [
                        64,
                        "    version   = \"latest\"\n"
                    ],
                    [
                        65,
                        "  }\n"
                    ],
                    [
                        66,
                        "  tags = {\n"
                    ],
                    [
                        67,
                        "    environment = \"dev\"\n"
                    ],
                    [
                        68,
                        "    owner       = \"vidhya\"\n"
                    ],
                    [
                        69,
                        "  }\n"
                    ],
                    [
                        70,
                        "}\n"
                    ]
                ],
                "file_path": "/spoke2/spoke2.tf",
                "file_abs_path": "/home/runner/work/azure-hub-spoke-iac/azure-hub-spoke-iac/azure-hub-spoke/spoke2/spoke2.tf",
                "repo_file_path": "/azure-hub-spoke/spoke2/spoke2.tf",
                "file_line_range": [
                    43,
                    70
                ],
                "resource": "azurerm_windows_virtual_machine.vm1",
                "evaluations": null,
                "check_class": "checkov.terraform.checks.resource.azure.WinVMEncryptionAtHost",
                "fixed_definition": null,
                "entity_tags": {
                    "environment": "dev",
                    "owner": "vidhya"
                },
                "caller_file_path": null,
                "caller_file_line_range": null,
                "resource_address": null,
                "severity": null,
                "bc_category": null,
                "benchmarks": null,
                "description": null,
                "short_description": null,
                "vulnerability_details": null,
                "connected_node": null,
                "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/azure-policies/azure-iam-policies/ensure-azure-windows-vm-enables-encryption",
                "details": [],
                "check_len": null,
                "definition_context_file_path": "/home/runner/work/azure-hub-spoke-iac/azure-hub-spoke-iac/azure-hub-spoke/spoke2/spoke2.tf",
                "breadcrumbs": {
                    "location": [
                        {
                            "type": "resource",
                            "name": "azurerm_resource_group.spoke2",
                            "path": "/home/runner/work/azure-hub-spoke-iac/azure-hub-spoke-iac/azure-hub-spoke/spoke2/spoke2.tf",
                            "module_connection": false
                        }
                    ],
                    "resource_group_name": [
                        {
                            "type": "resource",
                            "name": "azurerm_resource_group.spoke2",
                            "path": "/home/runner/work/azure-hub-spoke-iac/azure-hub-spoke-iac/azure-hub-spoke/spoke2/spoke2.tf",
                            "module_connection": false
                        }
                    ]
                }
            }
        ]
    },
    "rewrite": {
        "updated_files": [
            {
                "file": "azure-hub-spoke/spoke2/spoke2.tf",
                "changes": "autofixed"
            },
            {
                "file": "azure-hub-spoke/spoke1/spoke1.tf",
                "changes": "autofixed"
            }
        ],
        "count": 2
    },
    "validation": {
        "status": "error",
        "message": "Checkov execution failed",
        "raw_error": ""
    },
    "explanation": {
        "title": "Agentic IaC Auto-Remediation Report",
        "timestamp": "2025-11-22 09:33:40.048708",
        "initial_violations": [
            {
                "file": "azure-hub-spoke/spoke2/spoke2.tf",
                "line": 22,
                "issue": "Missing NSG association for subnet",
                "severity": "high",
                "fix_hint": "Attach azurerm_network_security_group to this subnet",
                "resource_type": "azurerm_subnet"
            },
            {
                "file": "azure-hub-spoke/spoke2/spoke2.tf",
                "line": 54,
                "issue": "Missing NSG association for subnet",
                "severity": "high",
                "fix_hint": "Attach azurerm_network_security_group to this subnet",
                "resource_type": "azurerm_subnet"
            },
            {
                "file": "azure-hub-spoke/spoke1/spoke1.tf",
                "line": 25,
                "issue": "Reference to undefined network security group",
                "severity": "high",
                "fix_hint": "Define azurerm_network_security_group.default before referencing it",
                "resource_type": "azurerm_subnet"
            },
            {
                "file": "azure-hub-spoke/spoke1/spoke1.tf",
                "line": 45,
                "issue": "Reference to undefined network security group",
                "severity": "high",
                "fix_hint": "Define azurerm_network_security_group.default before referencing it",
                "resource_type": "azurerm_subnet"
            },
            {
                "file": "azure-hub-spoke/hub/firewall.tf",
                "line": 12,
                "issue": "Missing NSG association for Azure Firewall subnet",
                "severity": "high",
                "fix_hint": "Attach azurerm_network_security_group to azurerm_subnet.AzureFirewallSubnet",
                "resource_type": "azurerm_subnet"
            },
            {
                "file": "azure-hub-spoke/hub/firewall.tf",
                "line": 24,
                "issue": "Open inbound rule exposes port 22 to the world",
                "severity": "high",
                "fix_hint": "Restrict source_address_prefix for inbound rule to a specific IP or range",
                "resource_type": "azurerm_network_security_rule"
            },
            {
                "file": "/hub/firewall.tf",
                "resource": "azurerm_network_security_rule.bad_rule",
                "check_id": "CKV_AZURE_10",
                "check_name": "Ensure that SSH access is restricted from the internet"
            },
            {
                "file": "/spoke2/spoke2.tf",
                "resource": "azurerm_windows_virtual_machine.vm1",
                "check_id": "CKV_AZURE_50",
                "check_name": "Ensure Virtual Machine Extensions are not Installed"
            },
            {
                "file": "/spoke2/spoke2.tf",
                "resource": "azurerm_windows_virtual_machine.vm1",
                "check_id": "CKV_AZURE_151",
                "check_name": "Ensure Windows VM enables encryption"
            }
        ],
        "rewrite_actions": [
            {
                "file": "azure-hub-spoke/spoke2/spoke2.tf",
                "change_summary": "autofixed"
            },
            {
                "file": "azure-hub-spoke/spoke1/spoke1.tf",
                "change_summary": "autofixed"
            }
        ],
        "final_validation": {
            "status": "error",
            "message": "Checkov execution failed",
            "raw_error": ""
        },
        "human_summary": "The rewriter attempted to fix violations, but Checkov still reports remaining issues.\nCloud engineering review is required before merge.\nSee pipeline-result.json for full details."
    }
}